<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="XXXXXX" />
  <title>TeXエスケープ検証</title>
  <style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
</style>
  <style type="text/css">body {font-family: "Yu Mincho", "Times New Roman", serif;max-width: 800px;margin: auto;line-height: 1.8;padding: 2em;}#title-block-header{margin-bottom:1.5em;}#title-block-header .title{text-align:center;font-size:2rem;font-weight:700;margin:0 0 0.4em 0;}#title-block-header .author,#title-block-header .approver,#title-block-header .date{text-align:right;font-size:0.95rem;color:#444;margin:0;}#title-block-header::after{content:"";display:block;height:1px;background:#aaa;margin-top:1em;}div.image-group {display: flex;flex-wrap: wrap;justify-content: center;gap: 8px;margin: 1em 0;}div.image-group img {max-height: 180px;height: auto;width: auto;cursor: zoom-in;transition: transform 0.2s;}div.image-group figure figcaption {text-align: center;}#img-modal {display: none;position: fixed;z-index: 9999;top: 0; left: 0; right: 0; bottom: 0;background: rgba(0, 0, 0, 0.85);justify-content: center;align-items: center;}.no-scroll{ overflow:hidden; }.img-modal__backdrop{position:absolute; inset:0;background:rgba(0,0,0,.85);}.img-modal__panel{position:relative; margin:0;max-width:95vw; max-height:95vh;display:flex; flex-direction:column; align-items:center;}.img-modal__caption{margin-top:.5rem; color:#ddd; font-size:.9em; text-align:center;}.img-modal__close{position:absolute;top:.4rem; right:.4rem;width:40px; height:40px;border:none; border-radius:999px;background:rgba(255,255,255,.28); color:#fff; font-size:22px; font-weight:700;line-height:40px; text-align:center;cursor:pointer;backdrop-filter:saturate(140%) blur(2px); box-shadow:0 2px 10px rgba(0,0,0,.35);transition:background .15s ease, transform .08s ease, color .15s ease;}#img-modal.is-open { display: flex; }.img-modal__close:hover,.img-modal__close:focus-visible{background:rgba(255,255,255,.45);color:#000;outline:none;}.img-modal__close:active{transform:scale(.96);}img {max-width: 100%;max-height: 70vh;height: auto;display: block;margin: 1em auto;}pre code {background: #f0f0f0;border: 1px solid #ccc;padding: 0.5em 0.8em;border-radius: 6px;font-family: "Yu Mincho", "Times New Roman", serif;font-size: 0.9em;line-height: 1.4;display: block;overflow-x: auto;}</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">TeXエスケープ検証</h1>
<p class="author">著者:
XXXXXX
</p>
<p class="date">2025年8月</p>
</header>
<h1 id="特殊文字祭り">特殊文字祭り</h1>
<h2 id="lua">LUA</h2>
<pre><code>-- TeXの制御文字 → エスケープ文字
-- TeXの制御文字のマッピング表
local TeX_map = {
  [&quot;\\&quot;] = &quot;\\textbackslash&quot;, [&quot;#&quot;] = &quot;\\#&quot;, [&quot;%$&quot;] = &quot;\\$&quot;, [&quot;%%&quot;] = &quot;\\%%&quot;, [&quot;&amp;&quot;] = &quot;\\&amp;&quot;,
  [&quot;~&quot;] = &quot;\\textasciitilde&quot;, [&quot;%^&quot;] = &quot;\\textasciicircum&quot;, [&quot;{&quot;] = &quot;\\{{&quot;, [&quot;}&quot;] = &quot;\\}&quot;,
}</code></pre>
<h2 id="通常文中para-plain">通常文中（Para / Plain）</h2>
<ul>
<li>バックスラッシュ: <code>\\</code> → 1つの <code>\</code></li>
<li>ハッシュ: #</li>
<li>ドル: $</li>
<li>パーセント: %</li>
<li>アンパサンド: &amp;</li>
<li>チルダ: ~</li>
<li>ハット: ^</li>
<li>波括弧(開): {</li>
<li>波括弧(閉): }</li>
</ul>
<p><strong>まとめて一行</strong>： <code>\\</code> # $ % &amp; ~ ^ {
}</p>
<h2 id="url-パス">URL / パス</h2>
<ul>
<li><a href="https://example.com/a_b?x=1&amp;y=2#sec">テキスト: # $ %
&amp; ~ ^ { } \</a></li>
<li>https://example.com/a_b?x=1&amp;y=2#sec</li>
<li>C:_v1.2%bar.txt</li>
</ul>
<h2 id="インラインコード">インラインコード</h2>
<p><code>a_b_c</code>, <code>100%</code>, <code>x^2</code>,
<code>C:\path\foo</code>, <code>\{raw\}</code></p>
<h2 id="コードブロック">コードブロック</h2>
<pre class="text"><code>a_b_c
100%
x^2 + y^2
\LaTeX \textbf{bold}</code></pre>
<h2 id="数式-はそのまま">数式（<span class="math inline">…</span>
はそのまま）</h2>
<p>インライン: <span class="math inline"><em>x</em><sup>2</sup> + <em>y</em><sup>2</sup> = <em>z</em><sup>2</sup></span></p>
<p>ディスプレイ:</p>
<p><span class="math display"><em>E</em> = <em>m</em><em>c</em><sup>2</sup></span></p>
<h2 id="矢印記号">矢印・記号</h2>
<p>→：<code>-&gt;</code>, ⇔：<code>&lt;-&gt;</code><br />
≦：<code>&lt;=</code>, ≧：<code>&gt;=</code>, ±：<code>+-</code></p>
<h2 id="リストparagraphの一種-置換されるべき">リスト（Paragraphの一種）—
<strong>置換されるべき</strong></h2>
<ul>
<li># $ % &amp; ~ ^ { } \</li>
<li>Windowsパス例:
<code>C:\\Users\\foo\\bar</code>（※インラインコードなので置換禁止）</li>
</ul>
<h2 id="表tableセルは基本テキスト-置換されるべき">表（Tableセルは基本テキスト）—
<strong>置換されるべき</strong></h2>
<table>
<thead>
<tr>
<th>項目</th>
<th>含む文字</th>
</tr>
</thead>
<tbody>
<tr>
<td>記号列</td>
<td># $ % &amp; ~ ^ { } \</td>
</tr>
</tbody>
</table>
<h2 id="連続境界">連続／境界</h2>
<ul>
<li>記号連結1: #$%&amp;~^{}\</li>
<li>記号連結2: \ # \ $ \ % \ &amp; \ ~ \ ^ \ { \ }</li>
<li>文末＆行頭: 文末%<br />
次行先頭# 次行先頭$</li>
</ul>
<script>
document.addEventListener("DOMContentLoaded", () => {
  // 多重初期化ガード
  if (window.__imgModalInit) return;
  window.__imgModalInit = true;

  // モーダル生成（既存がなければ）
  let modal = document.getElementById("img-modal");
  if (!modal) {
    modal = document.createElement("div");
    modal.id = "img-modal";
    modal.setAttribute("role", "dialog");
    modal.setAttribute("aria-modal", "true");
    modal.innerHTML = `
      <div class="img-modal__backdrop" data-close></div>
      <figure class="img-modal__panel">
        <img alt="">
        <figcaption class="img-modal__caption" hidden></figcaption>
        <button type="button" class="img-modal__close" aria-label="閉じる" title="閉じる">×</button>
      </figure>
    `;
    document.body.appendChild(modal);
  }

  const imgEl   = modal.querySelector("img");
  const capEl   = modal.querySelector(".img-modal__caption");
  const closeEl = modal.querySelector(".img-modal__close");

  let lastFocused = null;

  const openModal = (src, altText = "") => {
    lastFocused = document.activeElement; // ← ここで保存
    imgEl.src = src;
    imgEl.alt = altText;
    if (altText && altText.trim()) {
      capEl.textContent = altText;
      capEl.hidden = false;
    } else {
      capEl.textContent = "";
      capEl.hidden = true;
    }
    modal.classList.add("is-open");
    document.documentElement.classList.add("no-scroll");
    closeEl.focus({ preventScroll: true });
  };

  const closeModal = () => {
    modal.classList.remove("is-open");
    document.documentElement.classList.remove("no-scroll");
    if (lastFocused && typeof lastFocused.focus === "function") {
      lastFocused.focus({ preventScroll: true });
    }
  };

  const handleImageClick = (e) => {
    const img = e.target.closest(".image-group img");
    if (!img) return;
    openModal(img.currentSrc || img.src, img.getAttribute("alt") || "");
  };

  const handleModalClick = (e) => {
    // 背景クリック or ×ボタンで閉じる
    if (e.target.hasAttribute("data-close") || e.target === closeEl) {
      closeModal();
    }
  };

  const handleKeydown = (e) => {
    if (!modal.classList.contains("is-open")) return;
    if (e.key === "Escape") closeModal();
  };

  // イベント登録
  document.body.addEventListener("click", handleImageClick);
  modal.addEventListener("click", handleModalClick);
  document.addEventListener("keydown", handleKeydown);

});
</script>
</body>
</html>
